<html>
  <head>
    <script src='./pkg/rust_wasm_test.js'></script>
  </head>
  <body>
    <h1>Rust vs JS sort benchmark</h1>
    <p>Click the buttons and check JS console for results</p>
    <button id="jsBtn">Sort with JS</button>
    <button id="rustBtn">Sort with Rust</button>
    <button id="jsWorkerBtn">Sort with JS in JS WebWorker</button>
    <button id="jsWorkerRustBtn">Sort with Rust in JS WebWorker</button>

    <script>
      // globally defined by rust_wasm_test.js
      const { sort: rustSortLib } = wasm_bindgen;
      
      const LEN = 10000000
      const ARRAY = Array.from({ length: LEN }, () => Math.floor(Math.random() * LEN))
      
      function jsSort() {
        const arr = structuredClone(ARRAY)
        console.time("JS sort");
        const res = arr.sort((a, b) => a - b);
        console.timeEnd("JS sort");
      }

      function rustSort() {
        const arr = structuredClone(ARRAY)
        console.time("Rust sort");
        const res = rustSortLib(arr);
        console.timeEnd("Rust sort");
      }

      const worker = new Worker("worker.js");
      function jsWorkerSort() {
        worker.postMessage('js');
      }
      function jsWorkerRustSort() {
        worker.postMessage('rust');
      }

      document.getElementById('jsBtn').addEventListener('click', jsSort)
      document.getElementById('jsWorkerBtn').addEventListener('click', jsWorkerSort)
      document.getElementById('jsWorkerRustBtn').addEventListener('click', jsWorkerRustSort)
      
      console.time("Load rust lib");
      wasm_bindgen().then(() => {
        console.timeEnd("Load rust lib");
        document.getElementById('rustBtn').addEventListener('click', rustSort)
        console.log(`Ready to sort with ${LEN} elements. Click a button!`)
      })
    </script>
  </body>
</html>